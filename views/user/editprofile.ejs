<%- include('../Layout/usertem.ejs') %>
  <%- include ("../layout/cdn")%>
  <%- include ("../layout/userHeader.ejs")%>
  
    <main class="main">
      
        <div class="page-header breadcrumb-wrap">
          <div class="container">
            <div class="breadcrumb">
              <a href="index.html" rel="nofollow">Home</a>
              <span></span> Pages
              <span></span> Account
              <span style="color: #395ae0;">ACCOUNT DETAILS</span>
            </div>
          </div>
        </div>
        

        <section class="pt-50 pb-50">

          <div class="container">
            <div class="row">
              <div class="col-lg-10 m-auto">
                <div class="row">
                  <%- include ("../layout/accountSideBar")%>
                    <div class="col-md-8">
                      <div class="card">
                        <div class="card-header">
                          <h5>Edit Details</h5>
                        </div>
                        <div class="card-body">

                          <form method="POST" id="myForm" action="/editprofile" onchange="return validation(event)">
                            <div class="row">
                              <div class="form-group col-md-12">
                                <label>Full Name <span class="required">*</span></label>
                                <input required="" id="name" class="form-control square" name="fullName" value="<%=user?.fullName%>"
                                  type="text">
                                  <div id="errorname" class="ms-2 text-danger"></div>
                              </div>

                              <div class="form-group col-md-12">
                                <label>Email Address <span class="required">*</span></label>
                                <input required="" id="email" class="form-control square" name="email" value="<%=user?.email%>"
                                  type="email">
                                  <div id="errorphone" class="ms-2 text-danger"></div>
                              </div>
                              <div class="form-group col-md-12">
                                <label class="form-label">Phone</label>
                                <input class="form-control" id="phoneNumber" type="tel" name="phoneNumber" value="<%= user?.phoneNumber %>"
                                  id="user_phone" required>
                                <div id="errorphoneNumber" class="ms-2 text-danger"> </div>
                               
                                <div class="col-md-12">
                                  <button style="margin: 10px;" type="submit" class="btn btn-fill-out submit" name="submit"
                                    value="Submit">Save
                                    Changes</button>
                                </div>
                              </div>
                          </form>
                          <small><a href="/forgotpassword">Forgot password</a></small>
                        </div>
                      </div>


                    </div>


                </div>
              </div>
            </div>
          </div>
        </section>
    </main>

    <script>
        // Form validation on input
        document.getElementById('name').addEventListener('input', nameChecking);
        document.getElementById('email').addEventListener('input', emailChecking);
        document.getElementById('phoneNumber').addEventListener('input', phoneNumberChecking);
        
        // Main validation function
        function validation(event) {
            event.preventDefault(); // Prevent default form submission
        
            // Check all validations
            const isNameValid = nameChecking();
            const isEmailValid = emailChecking();
            const isPhoneValid = phoneNumberChecking();
        
            // Only submit if all validations pass
            if (isNameValid && isEmailValid && isPhoneValid) {
                document.getElementById("myForm").submit();
                return true;
            }
            return false;
        }
        
        // Name validation
        function nameChecking() {
            const name = document.getElementById("name").value;
            const errorName = document.getElementById("errorname");
            const namePattern = /^[A-Za-z\s]+$/;
            // Remove leading/trailing spaces for validation
            if (name.trim() === "") {
                errorName.innerHTML = "Please enter your name";
                return false;
            } else if (!namePattern.test(name)) {
                errorName.innerHTML = "Name should contain only alphabets";
                return false;
            } else if (name.trim().length > 50) {
                errorName.innerHTML = "Name is too long (maximum 50 characters)";
                return false;
            } else if (name.trim().length < 3) {
                errorName.innerHTML = "Name must be at least 3 characters long";
                return false;
            } else {
                errorName.innerHTML = "";
                return true;
            }
        }
        
        // Email validation
        function emailChecking() {
            const email = document.getElementById("email").value;
            const errorEmail = document.getElementById("erroremail");
            
            // Email regex pattern
            const emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            
            if (email.trim() === "") {
                errorEmail.innerHTML = "Please enter your email";
                return false;
            } else if (!emailPattern.test(email)) {
                errorEmail.innerHTML = "Please enter a valid email address";
                return false;
            } else {
                errorEmail.innerHTML = "";
                return true;
            }
        }
        
        // Phone number validation
        function phoneNumberChecking() {
            const phoneNumber = document.getElementById("phoneNumber").value;
            const errorPhone = document.getElementById("errorphoneNumber");
            
            // Remove any non-digit characters for validation
            const cleanNumber = phoneNumber.replace(/\D/g, '');
            
            if (phoneNumber.trim() === "") {
                errorPhone.innerHTML = "Please enter your phone number";
                return false;
            } else if (cleanNumber.length !== 10) {
                errorPhone.innerHTML = "Phone number must be 10 digits";
                return false;
            } else if (!/^[1-9]\d{9}$/.test(cleanNumber)) {
                errorPhone.innerHTML = "Please enter a valid phone number";
                return false;
            } else {
                errorPhone.innerHTML = "";
                return true;
            }
        }
        </script>
    
    <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.js"></script>
    <script type="text/javascript" src="js/custom.js"></script>